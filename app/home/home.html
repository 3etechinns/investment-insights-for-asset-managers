<!-- =========== User is Authenticated ===========  -->
<section class="isAuthenticated" ng-if="vm.auth.isAuthenticated()">
    <section class="healthLayout">
        <div class="benefitkit">
            <div class="benefitdata">
                <section class="dashbaordPanel">
                    <div class="userProfile">
                        <div class="portfolioArea">
                            <div class="serviceHeader">
                                <i class="fa fa-university" aria-hidden="true"></i> Investment Portfolio
                            </div>

                            <div class="widget--header"><h2 class="base--h2 widget--header-title">Choose a portfolio</h2>
                                <div class="widget--header-spacer"></div>
                                <button class="base--button widget--header-button" ng-click="portfolioButton()">View API</button>
                            </div>
                            <div ng-init="vm.initialSetup()">
                                <uib-accordion ng-model="oneAtATime" close-others="oneAtATime">
                                    <div uib-accordion-group class="panel-default" ng-repeat="portfolio in portfolios" is-open="status.open" ng-click="vm.getHoldings(portfolio)">
                                        <table id="portfolio">
                                            <tr>
                                                <th>Company</th>
                                                <th>Asset</th>
                                                 <!--<th>InstrumentID</th>-->
                                                <th>Shares QTY</th>
                                                <th>Discover</th>
                                            </tr>
                                            <tr ng-repeat="holding in holdings" ng-click="vm.toDiscovery(holding.companyName)">
                                                <td>{{ holding.companyName }}</td>
                                                <td>{{ holding.asset }}
                                                <!--<td>{{ holding.instrumentId }}-->
                                                <td>{{ holding.quantity }}</td>
                                                <!--<td><button ng-model="holding.companyName" ng-click="toDiscovery($company)" value="{{holding.companyName}}">Select</button></td>-->
                                                <td class="discoverRun"><button class="base--button widget--header-button">Call Watson Discovery</button></td>
                                            </tr>
                                        </table>

                                        <uib-accordion-heading>
                                            <p style="margin-bottom: 0;">{{portfolio.name | titleCase }} <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': status.open, 'glyphicon-chevron-right': !status.open}"></i></p>
                                        </uib-accordion-heading>
                                    </div>
                                </uib-accordion>
                            </div>
                             <div class="loadingspinner" ng-show="loading"> </div>
                              <!--<img src="/assets/images/spinner.gif">-->
                        </div>

                        <div class="riskArea">
                            <hr/>
                            <div class="serviceHeader">
                                <i class="fa fa-user-md" aria-hidden="true"></i> Portfolio Optimizer
                            </div>
                            Under Development
                            <aside class="insidePanel">
                            </aside>
                        </div>
                    </div>

                    <div class="newsArea">
                        <div class="serviceHeader">
                            <i class="fa fa-newspaper-o" aria-hidden="true"></i> Watson Discovery News
                        </div>

                        <div class="top-stories widget" >
                            <div class="widget--header">
                                <h2 class="base--h2 widget--header-title">Top Stories</h2>
                                <div class="widget--header-spacer"></div>
                                <button class="base--button widget--header-button" ng-click="discoveryNewsButton()" ng-if="showMessage == false">View API Response</button>
                            </div>

                            <span class="userMessage" ng-if="showMessage == true">
                                <p>
                                    Choose a portfolio to view Discovery
                                </p>
                            </span>
                            
                            <span ng-if="showMessage == false">
                                <p class="base--p top-stories--description">Find the most recent and relevant news articles that impact your portfolio.<br>
                                Showing <strong>20</strong> of {{newslist.matching_results}} matching documents</p>
                            </span>
                        </div>

                        <div class="top-stories widget" >
                            <div class="top-stories--list" ng-repeat="news in newslist" ng-if="$index == 1">
                        
                                <div class="story" ng-repeat="items in news">
                                    <div class="story--date">{{dateAndTime(items.yyyymmdd)}}</div>

                                    <a class="story--title base--a results--a"
                                       href="{{items.url}}"
                                       target="_blank"
                                       title="{{items.title}}"
                                       rel="noopener noreferrer">{{items.title}}</a>
                                    <div class="story--source-and-score">
                                        <span class="base--p story--source">{{items.host}}</span>
                                        <span class="story--source-score-divider"> | </span>
                                        <span class="story--score base--p">
                                            <span>Score:</span> {{items.score}}
                                        </span>
                                        <span class="story--source-score-divider"> | </span>
                                        <span class="story--score base--p">
                                            <span>Sentiment:</span>
                                            <!--Checking the value where if negative or not-->
                                            <span ng-if="items.docSentiment.type === 'negative'" class="red">
                                                <strong>{{items.docSentiment.type}}</strong>
                                            </span>

                                            <span ng-if="items.docSentiment.type !== 'negative'" class="normal">
                                                <strong>{{items.docSentiment.type}}</strong>
                                            </span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <hr/>
                        <div class="sentimentsFound" ng-if="showMessage == false">
                            <span class="negativeCount">{{negativeCount}} Negative</span> 
                            <span class="positiveCount">{{positiveCount}} Positive</span> 
                            <span class="neutralCount">{{neutralCount}} Neutral</span> 
                        </div>
                    </div>

                    <!--Shock value calculated in controller-->
                    <div class="discoveryAnalytics" ng-if="showMessage == false">
                        <span class="discoveryAnalyticsMessage">Assumption made, <span class="redBold">({{shockvalue}}% fall)</span> to your portfolio based on the impacted news to your portfolio.</span>
                    </div>

                    <div class="analyticsArea">
                        <div class="marketScenarios">
                            <div class="serviceHeader">
                                <img src="/assets/images/market_Scenarios.svg" alt="market Scenarios" data-pin-nopin="true">
                                <span class="">Predictive Market-Scenarios Service</span>
                                <!--<i class="fa fa-pie-chart" aria-hidden="true"></i> Predictive-Market-Scenarios Service-->
                            </div>
                        </div>

                        <div class="instrumentAnalytics">
                            <div class="serviceHeader">
                                <!--<i class="fa fa-bar-chart" aria-hidden="true"></i> Simulated Instrument Analytics-->
                                <img src="/assets/images/instrument_Analytics.svg" data-pin-nopin="true"> 
                                <span class="">Simulated Instrument Analytics</span>
                                Analysis: {{analysisData}}
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </section>
</section>


<!-- =========== User is not Authenticated ===========  -->
<section ng-if="!vm.auth.isAuthenticated()" class="notAuthenticated">
    <br>
    You are not logged in! Please <a ng-click="vm.auth.login()">Log In</a> to continue.
</section>

